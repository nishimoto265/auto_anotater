# プロジェクト全体コンテキスト

## プロジェクト概要

### 基本情報
- **プロジェクト名**: オートアノテーションアプリ
- **目的**: 動画アノテーション作業の効率化・品質向上
- **開発手法**: V字モデル + 並列開発
- **開発期間**: 2025年6月〜
- **対象ユーザー**: 研究者、アノテーター、学生

### ビジネス目標
- **作業時間短縮**: 従来手法比70%短縮
- **品質向上**: 一貫性のあるアノテーション品質
- **効率化**: 1時間あたり処理フレーム数向上
- **負荷軽減**: 長時間作業でのストレス軽減

## 技術仕様概要

### アプリケーション仕様
- **入力**: mp4, avi動画（4K解像度）
- **処理**: 30fps → 5fps変換
- **出力**: jpg画像 + txtアノテーション
- **UI**: PyQt6/PySide6による白黒モダンデザイン
- **プラットフォーム**: ローカルPC（Windows/Linux）

### パフォーマンス目標
- **フレーム切り替え**: 50ms以下
- **BB描画**: 16ms以下
- **UI応答**: 100ms以内
- **起動時間**: 3秒以内
- **メモリ使用**: 20GB以内（64GB環境）

### 技術スタック
```
フロントエンド: PyQt6/PySide6
画像処理: OpenCV, Pillow
数値計算: NumPy
追跡アルゴリズム: 独自実装
将来拡張: YOLO対応
```

## アーキテクチャ概要

### モジュール構成
```
├── UIモジュール          # PyQt6によるユーザーインターフェース
├── 動画処理モジュール     # OpenCVによる動画読み込み・フレーム抽出
├── アノテーションモジュール # BB管理・保存機能
└── 追跡モジュール        # 自動追跡アルゴリズム
```

### データフロー
```
動画ファイル → フレーム抽出 → フレーム表示 → BB作成/編集 → アノテーション保存
                ↓
            フレームキャッシュ → 高速表示
                ↓
            自動追跡 → BB予測 → 手動確認/修正
```

### パフォーマンス戦略
- **メモリ管理**: 前後100フレーム先読み、LRUキャッシュ
- **マルチスレッド**: UI/画像読み込み/保存の並列処理
- **最適化**: 表示用1/2リサイズ、差分更新

## V字モデル開発戦略

### 開発フェーズ
```
Phase 1: 要件定義 → テスト設計（V字の準備）
Phase 2: 並列実装（V字の底辺）
Phase 3: 統合・検証（V字の右側）
```

### 並列開発戦略
- **Git ワークツリー**: 各機能の独立開発環境
- **マージキュー**: 品質ゲートによる段階的統合
- **自動化**: テスト実行・統合の自動化

### 品質保証
- **テスト駆動**: 実装前のテスト設計
- **継続的統合**: 自動テスト・品質チェック
- **品質ゲート**: 各段階での品質基準クリア

## Agent役割分担

### 開発Agent
- **requirements-agent**: 要件定義・受入条件策定
- **test-design-agent**: テスト設計・テストコード実装
- **backend-agent**: バックエンド実装・パフォーマンス最適化
- **frontend-agent**: UI実装・UX最適化
- **testing-agent**: テスト実行・品質検証
- **integration-agent**: 統合・リリース管理

### 連携フロー
```
requirements-agent → test-design-agent → (backend/frontend)-agent
                                              ↓
testing-agent ← integration-agent ← (実装完了)
```

## データ形式・規約

### アノテーションファイル形式
```
ファイル名: 000000.txt, 000001.txt, ...
フォーマット（1行1BB）:
個体ID YOLO_X YOLO_Y YOLO_W YOLO_H 行動ID 信頼度

例:
0 0.5 0.3 0.1 0.15 2 0.95
1 0.2 0.7 0.08 0.12 0 0.87
```

### 個体ID・行動ID
- **個体ID**: 0-15（16個体まで）
- **行動ID**: カスタマイズ可能（デフォルト: sit, stand, milk, water, food）
- **色分け**: HSV色相環による個体ID別色分け

### ディレクトリ構造
```
output/
├── frames/           # 抽出されたフレーム画像
│   ├── 000000.jpg
│   ├── 000001.jpg
│   └── ...
└── annotations/      # アノテーションファイル
    ├── 000000.txt
    ├── 000001.txt
    └── ...
```

## 主要機能仕様

### 起動オプション
1. **動画から**: 複数動画選択 → フレーム抽出 → アノテーション開始
2. **フレームから**: 既存フレーム → 新規アノテーション開始
3. **途中から**: 既存フレーム + アノテーション → 作業継続

### コア機能
- **BB操作**: 作成・編集・削除・ID/行動変更
- **追跡機能**: 自動追跡アルゴリズムによる後続フレーム予測
- **コピー機能**: 個別BBの複数フレームコピー（デフォルト50フレーム）
- **ジャンプ機能**: BB数変化フレームの検知・移動
- **自動保存**: リアルタイムアノテーション保存

### ショートカット
```
A/D: 前/次フレーム
W: BB作成モード
S: 選択BB削除
Ctrl+Z: 操作取り消し
Shift+A/D: 前/次の変化フレーム
数字キー0-9: 個体ID選択
F1-F5: 行動ID選択
```

## 品質基準・メトリクス

### 機能品質
- **要件充足率**: 100%
- **機能完成度**: 100%
- **ユーザビリティスコア**: 80点以上

### 技術品質
- **コードカバレッジ**: 80%以上
- **テスト合格率**: 100%
- **コード複雑度**: 10以下
- **重複率**: 5%以下

### パフォーマンス品質
- **フレーム切り替え**: 50ms以下
- **BB描画**: 16ms以下
- **UI応答**: 100ms以内
- **メモリ使用**: 20GB以内

### 運用品質
- **稼働率**: 99.9%以上
- **復旧時間**: 5秒以内
- **エラー率**: 1%以下

## リスク・制約事項

### 技術リスク
- **パフォーマンス**: 大容量動画での性能劣化
- **互換性**: 異なる動画形式での不安定性
- **メモリ**: 長時間使用でのメモリリーク

### 運用リスク
- **データ損失**: 作業中断時のデータ保護
- **学習コスト**: 新規ユーザーの操作習得
- **品質維持**: 複数ユーザー間での品質統一

### 制約事項
- **ローカル環境**: インターネット接続不要
- **リソース**: 64GBメモリ環境前提
- **OS**: Windows/Linux対応（macOS除く）

## 将来拡張計画

### Phase 4: 自動アノテーション対応
- **YOLOモデル統合**: ファインチューニングモデル対応
- **信頼度閾値**: 低信頼度BBの手動確認
- **バッチ処理**: 指定範囲の一括自動処理

### Phase 5: 高度機能
- **複数モデル**: モデル切り替えインターフェース
- **プラグイン**: カスタム追跡アルゴリズム
- **エクスポート**: 他形式への変換機能
- **クラウド**: オプションでクラウド連携

## 開発環境・ツール

### 必要環境
- **Python**: 3.8以上
- **メモリ**: 64GB推奨
- **ストレージ**: SSD推奨
- **GPU**: オプション（将来のYOLO対応）

### 開発ツール
- **IDE**: VSCode, PyCharm推奨
- **バージョン管理**: Git + ワークツリー
- **テスト**: pytest + coverage
- **品質**: flake8, black, mypy
- **CI/CD**: GitHub Actions推奨

## プロジェクト成功指標

### 定量指標
- **開発期間**: 計画通りの完了
- **品質メトリクス**: 全基準クリア
- **パフォーマンス**: 全目標達成
- **テストカバレッジ**: 80%以上

### 定性指標
- **ユーザー満足度**: アンケート80点以上
- **操作性**: 30分以内での習得
- **安定性**: 長時間使用での安定動作
- **拡張性**: 将来機能追加への対応

このプロジェクトコンテキストは、全Agentが共通理解を持つためのリファレンスドキュメントです。開発中は常にこの文脈を参照し、一貫した品質と方向性を保ってください。