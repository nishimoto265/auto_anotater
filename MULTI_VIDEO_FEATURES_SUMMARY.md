# 複数動画選択・並び替え・スタートフレーム番号機能 - 実装サマリー

## 🎯 実装完了機能

### ✅ 1. 複数動画選択機能
- **単一選択**: 従来通りの単一動画ファイル選択
- **複数選択**: 「複数選択」ボタンで複数動画ファイルを一括選択
- **重複防止**: 同じ動画ファイルの重複追加を自動防止
- **表示更新**: 選択状況を「○個の動画が選択されています」で表示

### ✅ 2. 動画並び替え機能
- **↑ 上へ移動**: 選択された動画をリスト内で上に移動
- **↓ 下へ移動**: 選択された動画をリスト内で下に移動
- **削除**: 不要な動画をリストから個別削除
- **クリア**: 動画リスト全体をワンクリックでクリア
- **視覚的確認**: QListWidget で動画リストを視覚的に管理

### ✅ 3. スタートフレーム番号設定
- **番号指定**: 0〜999999の範囲でスタートフレーム番号を設定
- **自動採番**: 指定番号から連続してフレーム番号を生成
- **例**: 300を指定 → `000300.jpg`, `000301.jpg`, `000302.jpg`...
- **6桁ゼロパディング**: 常に6桁の番号でファイル名生成

### ✅ 4. 複数動画処理オプション
- **連結処理**: 複数動画を連続したフレーム番号で処理
- **個別処理**: 各動画ごとに独立した番号体系で処理
- **動的UI**: 動画プロジェクト選択時のみ複数動画機能を表示

## 🔧 技術的実装詳細

### UIコンポーネント追加
```python
# 複数動画リスト表示
self.video_list_widget = QListWidget()

# 並び替えコントロール
self.move_up_btn = QPushButton("↑ 上へ")
self.move_down_btn = QPushButton("↓ 下へ")
self.remove_video_btn = QPushButton("削除")
self.clear_videos_btn = QPushButton("クリア")

# スタートフレーム番号設定
self.start_frame_spin = QSpinBox()
self.start_frame_spin.setRange(0, 999999)

# 連結処理オプション
self.concatenate_videos_check = QCheckBox("複数動画を連結して処理")
```

### 処理ロジック分岐
```python
# 単一動画 vs 複数動画の判定
source_type = self.config.get('source_type', 'video')

if source_type == 'multi_video':
    self.process_multiple_videos()
else:
    self.process_single_video()
```

### フレーム番号生成アルゴリズム
```python
# 単一動画: スタート番号から連続
actual_frame_number = start_frame_number + extracted_count
filename = f"{actual_frame_number:06d}.jpg"

# 複数動画（連結モード）: 全体で連続番号
filename = f"{current_frame_number:06d}.jpg"
current_frame_number += 1

# 複数動画（個別モード）: 動画ごとに番号リセット
filename = f"video{video_index + 1:02d}_{extracted_from_video + start_frame_number:06d}.jpg"
```

## 📊 使用例

### 例1: 単一動画でスタート番号300
```
設定: 
  - 動画: mouse_behavior.mp4
  - スタート番号: 300
  - 出力FPS: 5

出力ファイル:
  000300.jpg, 000301.jpg, 000302.jpg, 000303.jpg...
```

### 例2: 複数動画連結処理、スタート番号1000
```
設定:
  - 動画: [session1.mp4, session2.mp4, session3.mp4]
  - スタート番号: 1000
  - 連結処理: ON

出力ファイル:
  001000.jpg (session1の1フレーム目)
  001001.jpg (session1の2フレーム目)
  ...
  001150.jpg (session2の1フレーム目)
  001151.jpg (session2の2フレーム目)
  ...
  001300.jpg (session3の1フレーム目)
```

### 例3: 複数動画個別処理
```
設定:
  - 動画: [morning.mp4, afternoon.mp4]
  - スタート番号: 500
  - 連結処理: OFF

出力ファイル:
  video01_000500.jpg (morning.mp4の1フレーム目)
  video01_000501.jpg (morning.mp4の2フレーム目)
  video02_000500.jpg (afternoon.mp4の1フレーム目)
  video02_000501.jpg (afternoon.mp4の2フレーム目)
```

## 🚀 操作手順

1. **プロジェクト開始**
   ```
   python src/main.py
   ```

2. **複数動画選択**
   - 「新規動画プロジェクト」を選択
   - 「複数選択」ボタンをクリック
   - 複数の動画ファイルを選択（Ctrl+クリックで複数選択）

3. **並び替え**
   - 動画リストで処理したい順序に並び替え
   - ↑/↓ボタンで位置調整
   - 不要な動画は「削除」で除去

4. **スタート番号設定**
   - 「スタートフレーム番号」で開始番号を指定
   - 例: 300 → `000300.jpg`から開始

5. **処理オプション選択**
   - 「複数動画を連結して処理」をチェック → 連続番号
   - チェックなし → 動画ごとに独立番号

6. **出力先指定・処理開始**
   - 出力先ディレクトリを指定
   - 「プロジェクト開始」で処理実行

## 🎯 メリット・効果

### 研究効率の向上
- **バッチ処理**: 複数セッションの動画を一括処理
- **連番管理**: 実験全体で一貫したフレーム番号
- **順序制御**: 時系列順での正確なフレーム処理

### 操作性の向上
- **直感的UI**: ドラッグ&ドロップ風の並び替え操作
- **視覚的確認**: リスト表示で処理対象を明確に確認
- **柔軟な設定**: 用途に応じた処理モード選択

### データ管理の改善
- **命名規則統一**: 6桁ゼロパディングで一貫した命名
- **トレーサビリティ**: ファイル名から元動画を特定可能
- **スケーラビリティ**: 大量動画処理への対応

## 🧪 テスト結果

```
=== 総合テスト結果 ===
✅ プロジェクトダイアログ: PASS
✅ フレーム番号生成: PASS  
✅ 動画処理ロジック: PASS
✅ UIコンポーネント: PASS
✅ ワークフローシミュレーション: PASS

テスト項目: 5/5 成功 (100%)
```

## 📈 パフォーマンス

- **単一動画処理**: 従来通りの高速処理維持
- **複数動画処理**: 動画数に比例した処理時間
- **メモリ効率**: 一度に一つの動画のみロードして逐次処理
- **進捗表示**: リアルタイムで各動画の処理状況を表示

---

**実装完了日**: 2024-06-05  
**バージョン**: 3.0  
**ステータス**: ✅ プロダクション対応完了

**すべての要求機能が実装され、Fast Auto-Annotation Systemが大幅に機能強化されました！**